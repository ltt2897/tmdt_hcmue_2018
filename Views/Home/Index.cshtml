@*using PhuKienDienThoai.Models*@
@*model List<SanPham>*@
@using X.PagedList.Mvc.Core;
@using X.PagedList; 
@*@using X.PagedList;*@

<div class="features_items"><!--features_items-->
    <h2 class="title text-center"><span class="text-block">@ViewData["Title"]</span></h2>
    <div class="row">
    @foreach(var item in Model)
    {
        <div id="paypal-button" item-id="@item.id"></div>
        <div class="col-sm-4" style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis;">
            <div class="product-image-wrapper">
                <div class="single-products">
                    <div class="productinfo text-center">
                        <img src="~/images/SanPham/@item.HinhAnh" style="height: 100%; width:auto; max-height:130px" alt="" />
                        <h2>@((item.DonGia*(100 - item.PhanTramGiamGia)/100).ToString("#,0"))Đ</h2>
                        <p title="@item.TenSanPham">@item.TenSanPham</p>
                    </div>
                </div>
                <div class="choose">
                    <ul class="nav nav-pills nav-justified">
                        <li><a asp-controller="Wishlist" asp-area="Users" asp-action="ThemVaoWishList" data-id="@item.id" class="ThemVaoWishList"><i class="fa fa-plus-square"></i>Thêm vào wishlist</a></li>
                        <li><a asp-controller="SanPham" asp-action="index" asp-route-id="@item.id" asp-route-TenSanPham="@item.TenSanPham.Replace(" ","-")"><i class="fa fa-info"></i>Chi tiêt sản phẩm</a></li>
                    </ul>
                </div>
            </div>
        </div>
    }
    </div>
    <script src="https://www.paypalobjects.com/api/checkout.js"></script>
    <script>
        var host = document.location.href;

        var CREATE_PAYMENT_URL = host + 'Payment/CreatePayment';
        var EXECUTE_PAYMENT_URL = host + 'Payment/ExecutePayment';
        // var id = document.getElementsByClassName('paypal-button').getAttribute('item-id');

        paypal.Button.render({
            env: 'sandbox', //'production',
            commit: true, // Show a 'Pay Now' button

            payment: function (e) {
                return paypal.request.post(CREATE_PAYMENT_URL).then(function (data) {
                    return data.id;
                });
            },

            onAuthorize: function (data) {
                return paypal.request.post(EXECUTE_PAYMENT_URL, {
                    paymentID: data.paymentID,
                    payerID: data.payerID
                }).then(function () {
                    window.location.href = host + 'Payment/Success'
                });
            }

        }, '#paypal-button');
    </script>   
</div><!--features_items-->
@*Html.PagedListPager( myList, page => Url.Action("Index", new { page = page}) )*@
<div class="text-right">
    @Html.PagedListPager( (IPagedList)Model, page => Url.Action("Index", new { page }) )
</div>
@if(TempData["Message"]!=null)
{
    <script>
        alert("@Html.Raw(TempData["Message"])");
    </script>
}
